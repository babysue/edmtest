<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>活動報名 - Future Cities Symposium 2025</title>
  <style>
    body{font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;color:#111;margin:0;background:#f8fafc}
    .wrap{max-width:900px;margin:0 auto;padding:20px 16px}
    .header{background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);margin-bottom:24px;text-align:center}
    .btn{display:inline-block;padding:12px 18px;background:#2563eb;color:#fff;border-radius:10px;text-decoration:none;border:0;cursor:pointer;font-weight:600;transition:all 0.2s}
    .btn:hover{background:#1d4ed8;transform:translateY(-2px)}
    .btn:disabled{background:#9ca3af;cursor:not-allowed;transform:none}
    
    /* Form Styles */
    .form-container{background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1)}
    form{display:grid;grid-template-columns:repeat(6,1fr);gap:20px;margin-top:20px}
    .field{grid-column:span 6;display:flex;flex-direction:column;gap:8px}
    .half{grid-column:span 6}
    @media(min-width:720px){.half{grid-column:span 3}}
    input,select{padding:14px;border:1px solid #e5e7eb;border-radius:10px;font:inherit;transition:all 0.2s;background:#fff}
    input:focus,select:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
    input:invalid:not(:focus):not(:placeholder-shown){border-color:#dc2626}
    .req{color:#dc2626}
    .hint{color:#6b7280;font-size:14px;margin-bottom:10px}
    .ok{display:none;margin-top:20px;padding:16px;border:1px solid #c7f9cc;background:#ecfdf5;border-radius:10px;color:#065f46}
    .err{display:none;color:#dc2626;font-size:14px;margin-top:10px;padding:12px;background:#fef2f2;border:1px solid #fecaca;border-radius:8px}
    .loading{display:none;color:#2563eb;font-size:14px;margin-top:10px}
    .field label{font-weight:600;color:#374151}
    .back-link{display:inline-block;margin-top:20px;color:#2563eb;text-decoration:none;font-weight:500}
    .back-link:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1 style="margin:0 0 10px 0;color:#1f2937">Future Cities Symposium 2025</h1>
      <p style="margin:0;color:#6b7280;font-size:18px">報名表單 Registration Form</p>
    </div>
    
    <div class="form-container">
      <a href="edm.html" class="back-link">← 返回活動主頁 Back to Event Page</a>
      
      <h2 style="color:#1f2937;margin-top:20px">報名表單 Registration Form</h2>
      <p class="hint">帶 <span class="req">*</span> 為必填欄位 Fields marked with <span class="req">*</span> are required</p>

      <form id="f" novalidate>
        <div class="field half">
          <label for="first_name">First Name <span class="req">*</span></label>
          <input type="text" id="first_name" name="first_name" required placeholder="Benny">
        </div>
        
        <div class="field half">
          <label for="last_name">Last Name <span class="req">*</span></label>
          <input type="text" id="last_name" name="last_name" required placeholder="Liu">
        </div>

        <div class="field">
          <label for="email">Email Address <span class="req">*</span></label>
          <input type="email" id="email" name="email" required placeholder="you@example.com">
        </div>

        <div class="field">
          <label for="phone">Phone Number</label>
          <input type="tel" id="phone" name="phone" placeholder="Your phone number">
        </div>

        <div class="field">
          <label for="organization">Organization / Company</label>
          <input type="text" id="organization" name="organization" placeholder="Your organization">
        </div>

        <div class="field">
          <label for="job_title">Job Title</label>
          <input type="text" id="job_title" name="job_title" placeholder="Your job title">
        </div>

        <div class="field">
          <label for="company_type">公司性質類別 Company Type <span class="req">*</span></label>
          <select id="company_type" name="company_type" required>
            <option value="">Please select 請選擇</option>
            <option value="Public Company">Public Company 上市公司</option>
            <option value="Private Company">Private Company 私人公司</option>
            <option value="Government">Government 政府機構</option>
            <option value="Nonprofit">Nonprofit 非營利組織</option>
            <option value="Education">Education 教育機構</option>
            <option value="Startup">Startup 新創公司</option>
            <option value="Other">Other 其他</option>
          </select>
        </div>

        <div class="field">
          <label for="full_name_certificate">姓名全名（以發出出席證明書）<br>Full Name of attendee (for Attendance Certificate) <span class="req">*</span></label>
          <input type="text" id="full_name_certificate" name="full_name_certificate" required placeholder="First Last">
        </div>

        <div class="field">
          <button class="btn" type="submit" id="submit-btn">提交報名 Submit Registration</button>
          <div id="loading" class="loading">提交中，請稍候... Submitting, please wait...</div>
          <div id="err" class="err">提交失敗，請稍後再試。Submission failed, please try again later.</div>
          <div id="ok" class="ok">
            <strong>報名成功！</strong><br>
            感謝您的報名，我們已收到您的資料。<br><br>
            <strong>Registration Successful!</strong><br>
            Thank you for your registration. We have received your information.
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    // 替换为你的 Google Apps Script URL
    const postUrl = "https://script.google.com/macros/library/d/1vrqj6_KRHW6wrYmnnOl76MPdTz-UQ4jPctw8s_uFoOBkmbmS_BL35zle/6";
    
    document.getElementById('f').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.currentTarget;
      const submitBtn = document.getElementById('submit-btn');
      const loading = document.getElementById('loading');
      const err = document.getElementById('err');
      const ok = document.getElementById('ok');
      
      // 获取表单数据
      const data = Object.fromEntries(new FormData(form).entries());
      
      // 基本必填校验
      const requiredFields = ['first_name', 'last_name', 'email', 'company_type', 'full_name_certificate'];
      const missingFields = requiredFields.filter(field => !data[field] || data[field].trim() === '');
      
      if (missingFields.length > 0) {
        err.textContent = "請完整填寫所有必填欄位。Please complete all required fields.";
        err.style.display = 'block';
        ok.style.display = 'none';
        return;
      }
      
      // 邮箱格式验证
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(data.email)) {
        err.textContent = "請輸入有效的電子郵件地址。Please enter a valid email address.";
        err.style.display = 'block';
        ok.style.display = 'none';
        return;
      }

      // 隐藏错误/成功消息，显示加载中
      err.style.display = 'none';
      ok.style.display = 'none';
      submitBtn.disabled = true;
      loading.style.display = 'block';

      try {
        console.log('Sending data to server:', data);
        
        const response = await fetch(postUrl, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        
        console.log('Response status:', response.status);
        
        // 尝试解析响应
        let result;
        try {
          const responseText = await response.text();
          console.log('Response text:', responseText);
          result = JSON.parse(responseText);
        } catch (parseError) {
          console.error('Error parsing response:', parseError);
          throw new Error('伺服器回應格式錯誤 Server response format error');
        }
        
        if (result && result.ok) {
          // 成功
          ok.style.display = 'block';
          err.style.display = 'none';
          form.reset();
          
          // 5秒后重定向回主页面
          setTimeout(() => {
            window.location.href = 'edm.html';
          }, 5000);
        } else {
          // 服务器返回错误
          throw new Error(result.error || '未知伺服器錯誤 Unknown server error');
        }
        
      } catch (error) {
        console.error('Submission error:', error);
        err.textContent = `提交失敗: ${error.message}`;
        err.style.display = 'block';
        ok.style.display = 'none';
      } finally {
        // 恢复按钮状态
        submitBtn.disabled = false;
        loading.style.display = 'none';
      }
    });

    // 实时表单验证
    const inputs = document.querySelectorAll('input, select');
    inputs.forEach(input => {
      input.addEventListener('blur', () => {
        if (input.hasAttribute('required') && !input.value.trim()) {
          input.style.borderColor = '#dc2626';
        } else {
          input.style.borderColor = '#e5e7eb';
        }
      });
    });
  </script>
</body>
</html>
